wip_directory: $HOME/Documents/Zelda/4x_kdebiec_wip
pipes:
  source:
    ScanDirectorySource:
      input_directory: $HOME/.local/share/citra-emu/dump/textures/000400000008F900
      downstream_pipes: list_sorter
  list_sorter:
    ListSorter:
      downstream_pipes_for_filenames:
        actors: # waifu -> waifu
          filenames: actors.yaml
          downstream_pipes: actors_transparency_sorter
        interface: # handle manually; skip here
          filenames: interface.yaml
          downstream_pipes:
        maps: # xbrz
          filenames: maps.yaml
          downstream_pipes: xbrz-4
        lods: # skip; instead downscale highest-resolution version
          filenames: lods.yaml
          downstream_pipes:
        skip: # skip
          filenames: skip.yaml
          downstream_pipes:
        default: # waifu -> 3x -> noise
          downstream_pipes: default_size_sorter_1

  # Actors pipeline
  actors_transparency_sorter:
    TransparencySorter:
      downstream_pipes_for_transparent: actors_transparent_waifupixelmator2x-a-2-1
      downstream_pipes_for_opaque: actors_opaque_waifu-a-2-1

  # Actors transparent pipeline
  actors_transparent_waifupixelmator2x-a-2-1:
    WaifuPixelmator2xTransparentProcessor:
      denoise: 1
      downstream_pipes: actors_transparent_waifupixelmator2x-a-2-0
  actors_transparent_waifupixelmator2x-a-2-0:
    WaifuPixelmator2xTransparentProcessor:
      denoise: 0
      downstream_pipes: copyfile

  # Actors opaque pipeline
  actors_opaque_waifu-a-2-1:
    WaifuProcessor:
      denoise: 1
      downstream_pipes: actors_opaque_waifu-a-2-0
  actors_opaque_waifu-a-2-0:
    WaifuProcessor:
      denoise: 0
      downstream_pipes: pngquant

  # Maps pipeline
  xbrz-4:
    XbrzProcessor:
      scale: 4
      downstream_pipes: pngquant

  # Default pipeline
  default_size_sorter_1:
    RegexSorter:
      regex: ".*_(8x8|8x16|8x32|8x64|8x128|16x8|32x8|64x8|128x8)_.*"
      downstream_pipes_for_matched: xbrz-4
      downstream_pipes_for_unmatched: default_text_sorter
  default_text_sorter:
    TextImageSorter:
      downstream_pipes_for_shadow: shadow_potrace
      downstream_pipes_for_text:
      downstream_pipes_for_large_text: large_text_flattener
      downstream_pipes_for_nontext: default_transparency_sorter
  default_transparency_sorter:
    TransparencySorter:
      downstream_pipes_for_transparent: default_transparent_waifupixelmator2x-a-2-1
      downstream_pipes_for_opaque: default_opaque_waifu-a-2-1

  # Shadow pipeline
  shadow_potrace:
    PotraceShadowProcessor:
      scale: 4
      downstream_pipes: shadow_gaussian
  shadow_gaussian:
    AutomatorProcessor:
      workflow: gaussian-5.0
      downstream_pipes: pngquant

  # Large text pipeline
  large_text_flattener:
    FlattenProcessor:
      downstream_pipes: large_text_pixelmator-3x_1
  large_text_pixelmator-3x_1:
    AutomatorProcessor:
      workflow: 3x
      downstream_pipes: large_text_sharpen-100.100_1
  large_text_sharpen-100.100_1:
    AutomatorProcessor:
      workflow: sharpen-10.0-100
      downstream_pipes: large_text_pixelmator-3x_2
  large_text_pixelmator-3x_2:
    AutomatorProcessor:
      workflow: 3x
      downstream_pipes: large_text_sharpen-100.100_2
  large_text_sharpen-100.100_2:
    AutomatorProcessor:
      workflow: sharpen-10.0-100
      downstream_pipes: large_text_threshold
  large_text_threshold:
    ThresholdProcessor:
      workflow: 3x
      downstream_pipes: large_text_potrace
  large_text_potrace:
    PotraceProcessor:
      downstream_pipes: large_text_resize
  large_text_resize:
    ResizeProcessor:
      scale: 0.44444
      downstream_pipes: large_text_copyfile
  large_text_copyfile:
    CopyFileProcessor:
      output_directory: $HOME/Documents/Zelda/4x_kdebiec_large_text_cn

  # Default_transparent pipeline
  default_transparent_waifupixelmator2x-a-2-1:
    WaifuPixelmator2xTransparentProcessor:
      denoise: 1
      downstream_pipes: default_transparent_waifupixelmator2x-a-2-0
  default_transparent_waifupixelmator2x-a-2-0:
    WaifuPixelmator2xTransparentProcessor:
      denoise: 0
      downstream_pipes: default_transparent_size_sorter
  default_transparent_size_sorter:
    RegexSorter:
      regex: ".*_(8x8|8x16|8x32|8x64|8x128|16x8|16x16|16x32|16x64|16x128|32x8|32x16|32x32|32x64|32x128)_.*"
      downstream_pipes_for_matched: pngquant
      downstream_pipes_for_unmatched: default_transparent_lod
  default_transparent_lod:
    LODSorter:
      lods: lodsets.yaml
      downstream_pipes: copyfile

  # Default opaque pipeline
  default_opaque_waifu-a-2-1:
    WaifuProcessor:
      denoise: 1
      downstream_pipes: default_opaque_pixelmator-3x
  default_opaque_pixelmator-3x:
    AutomatorProcessor:
      workflow: 3x
      downstream_pipes: default_opaque_resize
  default_opaque_resize:
    ResizeProcessor:
      scale: 0.66667
      downstream_pipes: default_opaque_size_sorter
  default_opaque_size_sorter:
    RegexSorter:
      regex: ".*_(8x8|8x16|8x32|8x64|8x128|16x8|16x16|16x32|16x64|16x128|32x8|32x16|32x32|32x64|32x128)_.*"
      downstream_pipes_for_matched: pngquant
      downstream_pipes_for_unmatched: default_opaque_lod
  default_opaque_lod:
    LODSorter:
      lods: lodsets.yaml
      downstream_pipes: pngquant
  # Final output
  pngquant:
    PngquantProcessor:
      downstream_pipes: copyfile
  copyfile:
    CopyFileProcessor:
      output_directory: $HOME/Documents/Zelda/4x_kdebiec
